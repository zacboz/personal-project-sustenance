"use strict";

var login = {
    security: function security(mainService, $state) {
        return mainService.getAuth().catch(function (err) {
            console.log(err);
            if (err.status === 401) {
                $state.go("login");s;
            } else if (err.status === 403) {
                $state.go("home");
            }
        });
    }
};

angular.module('sustenance', ['ui.router']).config(function ($stateProvider, $urlRouterProvider) {

    $stateProvider.state('home', {
        url: '/',
        templateUrl: "/views/home.html",
        controller: 'homeCtrl'
    }).state('login', {
        url: '/login',
        templateUrl: "/views/login.html",
        controller: 'loginCtrl'
    }).state('collections', {
        url: '/collections',
        templateUrl: '/views/collections.html',
        controller: 'collectionsCtrl'
    }).state('details', {
        url: '/details/:collectionId',
        templateUrl: '/views/details.html',
        controller: 'detailsCtrl'
    }).state('profile', {
        url: '/profile',
        templateUrl: '/views/profile.html',
        controller: 'profileCtrl'
    });

    $urlRouterProvider.otherwise('/');
});
'use strict';

angular.module('sustenance').service('mainSrvc', function ($http) {

  this.searchLocation = function (location) {
    return $http({
      method: 'GET',
      url: '/sustenance/location/' + location
    }).then(function (response) {
      console.log(response.data);
      return response.data;
    });
  };

  this.searchTerm = function (term, location) {
    return $http({
      method: 'GET',
      url: '/sustenance/term/' + term + '/' + location
    }).then(function (response) {
      console.log(response.data);
      return response.data;
    });
  };

  this.getPublicCollections = function () {
    return $http({
      method: 'GET',
      url: '/sustenance/public-collections'
    }).then(function (response) {
      console.log(response);
      return response;
    });
  };

  this.getUserCollections = function (userId) {
    return $http({
      method: 'GET',
      url: '/sustenance/user-collections/' + userId
    }).then(function (response) {
      console.log(response);
      return response;
    });
  };

  this.createCollection = function (Name, Description, Imageurl, userId) {
    var collection = {
      Name: Name,
      Description: Description,
      Imageurl: Imageurl,
      userId: userId
    };
    return $http({
      method: 'POST',
      url: '/sustenance/collections/create',
      data: collection
    }).success(function (response) {
      console.log(response);
      return response;
    });
  };

  this.updateCollection = function (Name, Description, Imageurl, userId) {
    var collection = {
      Name: Name,
      Description: Description,
      Imageurl: Imageurl,
      userId: userId
    };
    return $http({
      method: 'PUT',
      url: '/sustenance/collections/update',
      data: collection
    }).success(function (response) {
      console.log(response);
      return response;
    });
  };

  this.deleteCollection = function (collection) {
    console.log(collection);
    var collectionId = collection.id;
    return $http({
      method: 'DELETE',
      url: '/sustenance/collections/' + collectionId
    }).then(function (response) {
      console.log(response);
      return response;
    });
  };

  this.addRestaurant = function (restaurant, collectionId) {
    var payload = {
      restaurant: restaurant,
      collectionId: collectionId
    };
    console.log(payload);
    return $http({
      method: 'POST',
      url: '/sustenance/restaurants/add',
      data: payload
    }).success(function (response) {
      console.log(response);
      return response;
    });
  };

  this.getRestaurantCollection = function (collectionId) {
    console.log(collectionId);
    return $http({
      method: 'GET',
      url: '/sustenance/restaurants/' + collectionId
    }).then(function (response) {
      console.log(response);
      return response;
    });
  };

  this.removeRestaurant = function (restaurant) {
    console.log(restaurant);
    // var Id = restaurant.id;
    var restaurantId = restaurant.id;
    console.log(restaurantId);
    return $http({
      method: 'DELETE',
      url: '/sustenance/restaurants/' + restaurantId
    }).then(function (response) {
      console.log(response);
      return response;
    });
  };

  var me = this;
  this.getUserProfile = function (callback) {
    if (me.currentUser) callback(me.currentUser);
    return $http({
      method: 'GET',
      url: '/sustenance/user-profile/'
    }).then(function (response) {
      me.currentUser = response.data;
      callback(me.currentUser);
    });
  };
});
'use strict';

angular.module('sustenance').controller('collectionsCtrl', function ($scope, $rootScope, mainSrvc, $stateParams) {

  $scope.refresh = function () {

    mainSrvc.getPublicCollections().then(function (response) {
      $scope.public_collections = response.data;
      console.log($scope.public_collections);
    });

    $scope.createCollection = function (Name, Description, Imageurl) {
      mainSrvc.createCollection(Name, Description, Imageurl, $rootScope.currentUser.userid);
      $scope.collection_name = '';
      $scope.collection_description = '';
      $scope.collection_imageurl = '';
    };

    $scope.deleteCollection = function (collection) {
      console.log(collection);
      mainSrvc.deleteCollection(collection).then(function () {
        mainSrvc.getPublicCollections().then(function (response) {
          $scope.public_collections = response.data;
        });
      });
    };

    mainSrvc.getUserProfile(function (currentUser) {
      console.log('FIRED', currentUser);
      $rootScope.currentUser = currentUser;
      mainSrvc.getUserCollections($rootScope.currentUser.userid).then(function (response) {
        $scope.user_collections = response.data;
        console.log($scope.user_collections);
      });
    });
  };
  $scope.refresh();
});
'use strict';

angular.module('sustenance').controller('detailsCtrl', function ($scope, mainSrvc, $stateParams, $rootScope) {

  $scope.updateCollection = function (Name, Description, Imageurl, userId) {
    console.log(userId);
    mainSrvc.updateCollection(Name, Description, Imageurl, userId);
    $scope.collection_name = '';
    $scope.collection_description = '';
    $scope.collection_imageurl = '';
    $scope.collection_userId = '';
  };

  $scope.searchTerm = function (term, location) {
    console.log(location);
    console.log(term);
    mainSrvc.searchTerm(term, location).then(function (response) {
      $scope.restaurants = JSON.parse(response.body);
      console.log($scope.restaurants.businesses);
      return $scope.restaurants.businesses;
    });
  };

  console.log($rootScope);

  mainSrvc.getRestaurantCollection($stateParams.collectionId).then(function (response) {
    $scope.restaurantCollection = response.data;
    console.log($scope.restaurantCollection);
  });

  $scope.addRestaurant = function (restaurant) {
    mainSrvc.addRestaurant(restaurant, $stateParams.collectionId).then(function (response) {
      console.log(response);
      $scope.add = response.body;
    });
  };

  $scope.removeRestaurant = function (restaurant) {
    console.log(restaurant);
    mainSrvc.removeRestaurant(restaurant).then(function () {
      mainSrvc.getRestaurantCollection($stateParams.collectionId).then(function (response) {
        $scope.restaurantCollection = response.data;
        console.log($scope.restaurantCollection);
      });
    });
  };
});
'use strict';

angular.module('sustenance').controller('homeCtrl', function ($scope, mainSrvc, $stateParams) {

  $scope.searchLocation = function (location) {
    console.log(location);
    mainSrvc.searchLocation(location).then(function (response) {
      $scope.restaurants = JSON.parse(response.body);
      console.log($scope.restaurants.businesses);
      return $scope.restaurants.businesses;
    });
  };

  mainSrvc.getPublicCollections().then(function (response) {
    $scope.collections = response.data;
    console.log($scope.collections);
  });
});
'use strict';

angular.module('sustenance').controller('loginCtrl', function ($scope, mainSrvc, $stateParams) {});
'use strict';

angular.module('sustenance').controller('profileCtrl', function ($scope, mainSrvc, $stateParams) {});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1haW5TcnZjLmpzIiwiY29udHJvbGxlcnMvY29sbGVjdGlvbnNDdHJsLmpzIiwiY29udHJvbGxlcnMvZGV0YWlsc0N0cmwuanMiLCJjb250cm9sbGVycy9ob21lQ3RybC5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ3RybC5qcyIsImNvbnRyb2xsZXJzL3Byb2ZpbGVDdHJsLmpzIl0sIm5hbWVzIjpbImxvZ2luIiwic2VjdXJpdHkiLCJtYWluU2VydmljZSIsIiRzdGF0ZSIsImdldEF1dGgiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJzdGF0dXMiLCJnbyIsInMiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsInNlcnZpY2UiLCIkaHR0cCIsInNlYXJjaExvY2F0aW9uIiwibG9jYXRpb24iLCJtZXRob2QiLCJ0aGVuIiwicmVzcG9uc2UiLCJkYXRhIiwic2VhcmNoVGVybSIsInRlcm0iLCJnZXRQdWJsaWNDb2xsZWN0aW9ucyIsImdldFVzZXJDb2xsZWN0aW9ucyIsInVzZXJJZCIsImNyZWF0ZUNvbGxlY3Rpb24iLCJOYW1lIiwiRGVzY3JpcHRpb24iLCJJbWFnZXVybCIsImNvbGxlY3Rpb24iLCJzdWNjZXNzIiwidXBkYXRlQ29sbGVjdGlvbiIsImRlbGV0ZUNvbGxlY3Rpb24iLCJjb2xsZWN0aW9uSWQiLCJpZCIsImFkZFJlc3RhdXJhbnQiLCJyZXN0YXVyYW50IiwicGF5bG9hZCIsImdldFJlc3RhdXJhbnRDb2xsZWN0aW9uIiwicmVtb3ZlUmVzdGF1cmFudCIsInJlc3RhdXJhbnRJZCIsIm1lIiwiZ2V0VXNlclByb2ZpbGUiLCJjYWxsYmFjayIsImN1cnJlbnRVc2VyIiwiJHNjb3BlIiwiJHJvb3RTY29wZSIsIm1haW5TcnZjIiwiJHN0YXRlUGFyYW1zIiwicmVmcmVzaCIsInB1YmxpY19jb2xsZWN0aW9ucyIsInVzZXJpZCIsImNvbGxlY3Rpb25fbmFtZSIsImNvbGxlY3Rpb25fZGVzY3JpcHRpb24iLCJjb2xsZWN0aW9uX2ltYWdldXJsIiwidXNlcl9jb2xsZWN0aW9ucyIsImNvbGxlY3Rpb25fdXNlcklkIiwicmVzdGF1cmFudHMiLCJKU09OIiwicGFyc2UiLCJib2R5IiwiYnVzaW5lc3NlcyIsInJlc3RhdXJhbnRDb2xsZWN0aW9uIiwiYWRkIiwiY29sbGVjdGlvbnMiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsUUFBUTtBQUNUQyxjQUFVLGtCQUFDQyxXQUFELEVBQWNDLE1BQWQsRUFBeUI7QUFDakMsZUFBT0QsWUFBWUUsT0FBWixHQUNKQyxLQURJLENBQ0UsVUFBQ0MsR0FBRCxFQUFTO0FBQ2RDLG9CQUFRQyxHQUFSLENBQVlGLEdBQVo7QUFDQSxnQkFBR0EsSUFBSUcsTUFBSixLQUFlLEdBQWxCLEVBQXNCO0FBQ3BCTix1QkFBT08sRUFBUCxDQUFVLE9BQVYsRUFBbUJDO0FBQ3BCLGFBRkQsTUFFTyxJQUFJTCxJQUFJRyxNQUFKLEtBQWUsR0FBbkIsRUFBdUI7QUFDNUJOLHVCQUFPTyxFQUFQLENBQVUsTUFBVjtBQUNEO0FBQ0YsU0FSSSxDQUFQO0FBU0Q7QUFYUSxDQUFaOztBQWNBRSxRQUFRQyxNQUFSLENBQWUsWUFBZixFQUE2QixDQUFDLFdBQUQsQ0FBN0IsRUFDS0MsTUFETCxDQUNZLFVBQVVDLGNBQVYsRUFBMEJDLGtCQUExQixFQUE2Qzs7QUFFakRELG1CQUNLRSxLQURMLENBQ1csTUFEWCxFQUNrQjtBQUNWQyxhQUFJLEdBRE07QUFFVkMscUJBQWEsa0JBRkg7QUFHVkMsb0JBQVk7QUFIRixLQURsQixFQU1LSCxLQU5MLENBTVcsT0FOWCxFQU1tQjtBQUNYQyxhQUFJLFFBRE87QUFFWEMscUJBQWEsbUJBRkY7QUFHWEMsb0JBQVk7QUFIRCxLQU5uQixFQVdLSCxLQVhMLENBV1csYUFYWCxFQVd5QjtBQUNqQkMsYUFBSSxjQURhO0FB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LFdBQVAsR0FBcUJDLEtBQUtDLEtBQUwsQ0FBV3pDLFNBQVMwQyxJQUFwQixDQUFyQjtBQUNBL0QsY0FBUUMsR0FBUixDQUFZK0MsT0FBT1ksV0FBUCxDQUFtQkksVUFBL0I7QUFDQSxhQUFPaEIsT0FBT1ksV0FBUCxDQUFtQkksVUFBMUI7QUFDRCxLQUpEO0FBS0QsR0FQRDs7QUFTRWQsV0FBU3pCLG9CQUFULEdBQWdDTCxJQUFoQyxDQUFxQyxVQUFTQyxRQUFULEVBQWtCO0FBQ3JEMkIsV0FBT21CLFdBQVAsR0FBcUI5QyxTQUFTQyxJQUE5QjtBQUNBdEIsWUFBUUMsR0FBUixDQUFZK0MsT0FBT21CLFdBQW5CO0FBQ0QsR0FIRDtBQUtILENBaEJEOzs7QUNBQTlELFFBQVFDLE1BQVIsQ0FBZSxZQUFmLEVBQTZCTyxVQUE3QixDQUF3QyxXQUF4QyxFQUFxRCxVQUFTbUMsTUFBVCxFQUFpQkUsUUFBakIsRUFBMkJDLFlBQTNCLEVBQXdDLENBSTVGLENBSkQ7OztBQ0FBOUMsUUFBUUMsTUFBUixDQUFlLFlBQWYsRUFBNkJPLFVBQTdCLENBQXdDLGFBQXhDLEVBQXVELFVBQVNtQyxNQUFULEVBQWlCRSxRQUFqQixFQUEyQkMsWUFBM0IsRUFBd0MsQ0FHOUYsQ0FIRCIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbG9naW4gPSB7XG4gICBzZWN1cml0eTogKG1haW5TZXJ2aWNlLCAkc3RhdGUpID0+IHtcbiAgICAgcmV0dXJuIG1haW5TZXJ2aWNlLmdldEF1dGgoKVxuICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgaWYoZXJyLnN0YXR1cyA9PT0gNDAxKXtcbiAgICAgICAgICAgJHN0YXRlLmdvKFwibG9naW5cIik7c1xuICAgICAgICAgfSBlbHNlIGlmIChlcnIuc3RhdHVzID09PSA0MDMpe1xuICAgICAgICAgICAkc3RhdGUuZ28oXCJob21lXCIpO1xuICAgICAgICAgfVxuICAgICAgIH0pXG4gICB9XG4gfVxuXG5hbmd1bGFyLm1vZHVsZSgnc3VzdGVuYW5jZScsIFsndWkucm91dGVyJ10pXG4gICAgLmNvbmZpZyhmdW5jdGlvbiggJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcil7XG5cbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC5zdGF0ZSgnaG9tZScse1xuICAgICAgICAgICAgICAgIHVybDonLycsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL3ZpZXdzL2hvbWUuaHRtbFwiLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdob21lQ3RybCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJyx7XG4gICAgICAgICAgICAgICAgdXJsOicvbG9naW4nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi92aWV3cy9sb2dpbi5odG1sXCIsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2xvZ2luQ3RybCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3RhdGUoJ2NvbGxlY3Rpb25zJyx7XG4gICAgICAgICAgICAgICAgdXJsOicvY29sbGVjdGlvbnMnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2NvbGxlY3Rpb25zLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb2xsZWN0aW9uc0N0cmwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0YXRlKCdkZXRhaWxzJyx7XG4gICAgICAgICAgICAgICAgdXJsOicvZGV0YWlscy86Y29sbGVjdGlvbklkJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9kZXRhaWxzLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkZXRhaWxzQ3RybCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3RhdGUoJ3Byb2ZpbGUnLHtcbiAgICAgICAgICAgICAgICB1cmw6Jy9wcm9maWxlJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9wcm9maWxlLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwcm9maWxlQ3RybCdcbiAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyXG4gICAgICAgICAgICAub3RoZXJ3aXNlKCcvJyk7XG5cbn0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3N1c3RlbmFuY2UnKS5zZXJ2aWNlKCdtYWluU3J2YycsIGZ1bmN0aW9uKCRodHRwKXtcblxuICB0aGlzLnNlYXJjaExvY2F0aW9uID0gZnVuY3Rpb24obG9jYXRpb24pe1xuICAgIHJldHVybiAkaHR0cCh7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgdXJsOiAnL3N1c3RlbmFuY2UvbG9jYXRpb24vJytsb2NhdGlvblxuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7XG4gICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICB9KTtcbiAgfTtcblxuICB0aGlzLnNlYXJjaFRlcm0gPSBmdW5jdGlvbih0ZXJtLCBsb2NhdGlvbil7XG4gICAgcmV0dXJuICRodHRwKHtcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICB1cmw6ICcvc3VzdGVuYW5jZS90ZXJtLycrdGVybSsnLycrbG9jYXRpb25cbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgfSk7XG4gIH07XG5cbiAgdGhpcy5nZXRQdWJsaWNDb2xsZWN0aW9ucyA9IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuICRodHRwKHtcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICB1cmw6ICcvc3VzdGVuYW5jZS9wdWJsaWMtY29sbGVjdGlvbnMnXG4gICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSk7XG4gIH07XG5cbiAgdGhpcy5nZXRVc2VyQ29sbGVjdGlvbnMgPSBmdW5jdGlvbih1c2VySWQpe1xuICAgIHJldHVybiAkaHR0cCh7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgdXJsOiAnL3N1c3RlbmFuY2UvdXNlci1jb2xsZWN0aW9ucy8nK3VzZXJJZFxuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0pO1xuICB9O1xuXG4gIHRoaXMuY3JlYXRlQ29sbGVjdGlvbiA9IGZ1bmN0aW9uKE5hbWUsIERlc2NyaXB0aW9uLCBJbWFnZXVybCwgdXNlcklkKXtcbiAgICB2YXIgY29sbGVjdGlvbiA9IHtcbiAgICAgIE5hbWU6IE5hbWUsXG4gICAgICBEZXNjcmlwdGlvbjogRGVzY3JpcHRpb24sXG4gICAgICBJbWFnZXVybDogSW1hZ2V1cmwsXG4gICAgICB1c2VySWQ6IHVzZXJJZFxuICAgIH1cbiAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICB1cmw6ICcvc3VzdGVuYW5jZS9jb2xsZWN0aW9ucy9jcmVhdGUnLFxuICAgICAgZGF0YTogY29sbGVjdGlvblxuICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0pO1xuICB9O1xuXG4gIHRoaXMudXBkYXRlQ29sbGVjdGlvbiA9IGZ1bmN0aW9uKE5hbWUsIERlc2NyaXB0aW9uLCBJbWFnZXVybCwgdXNlcklkKXtcbiAgICB2YXIgY29sbGVjdGlvbiA9IHtcbiAgICAgIE5hbWU6IE5hbWUsXG4gICAgICBEZXNjcmlwdGlvbjogRGVzY3JpcHRpb24sXG4gICAgICBJbWFnZXVybDogSW1hZ2V1cmwsXG4gICAgICB1c2VySWQ6IHVzZXJJZFxuICAgIH1cbiAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgIHVybDogJy9zdXN0ZW5hbmNlL2NvbGxlY3Rpb25zL3VwZGF0ZScsXG4gICAgICBkYXRhOiBjb2xsZWN0aW9uXG4gICAgfSkuc3VjY2VzcyhmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSk7XG4gIH07XG5cbiAgdGhpcy5kZWxldGVDb2xsZWN0aW9uID0gZnVuY3Rpb24oY29sbGVjdGlvbikge1xuICAgIGNvbnNvbGUubG9nKGNvbGxlY3Rpb24pO1xuICAgIHZhciBjb2xsZWN0aW9uSWQgPSBjb2xsZWN0aW9uLmlkO1xuICAgIHJldHVybiAkaHR0cCh7XG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgdXJsOiAnL3N1c3RlbmFuY2UvY29sbGVjdGlvbnMvJytjb2xsZWN0aW9uSWRcbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9KTtcbiAgfTtcblxuICB0aGlzLmFkZFJlc3RhdXJhbnQgPSBmdW5jdGlvbihyZXN0YXVyYW50LCBjb2xsZWN0aW9uSWQpIHtcbiAgICB2YXIgcGF5bG9hZCA9IHtcbiAgICAgIHJlc3RhdXJhbnQ6IHJlc3RhdXJhbnQsXG4gICAgICBjb2xsZWN0aW9uSWQ6IGNvbGxlY3Rpb25JZFxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhwYXlsb2FkKTtcbiAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICB1cmw6ICcvc3VzdGVuYW5jZS9yZXN0YXVyYW50cy9hZGQnLFxuICAgICAgZGF0YTogcGF5bG9hZFxuICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0pO1xuICB9XG5cbiAgdGhpcy5nZXRSZXN0YXVyYW50Q29sbGVjdGlvbiA9IGZ1bmN0aW9uKGNvbGxlY3Rpb25JZCl7XG4gICAgY29uc29sZS5sb2coY29sbGVjdGlvbklkKTtcbiAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIHVybDogJy9zdXN0ZW5hbmNlL3Jlc3RhdXJhbnRzLycrY29sbGVjdGlvbklkXG4gICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSk7XG4gIH07XG5cbiAgdGhpcy5yZW1vdmVSZXN0YXVyYW50ID0gZnVuY3Rpb24ocmVzdGF1cmFudCkge1xuICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnQpO1xuICAgIC8vIHZhciBJZCA9IHJlc3RhdXJhbnQuaWQ7XG4gICAgdmFyIHJlc3RhdXJhbnRJZCA9IHJlc3RhdXJhbnQuaWQ7XG4gICAgY29uc29sZS5sb2cocmVzdGF1cmFudElkKVxuICAgIHJldHVybiAkaHR0cCh7XG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgdXJsOiAnL3N1c3RlbmFuY2UvcmVzdGF1cmFudHMvJytyZXN0YXVyYW50SWRcbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9KTtcbiAgfTtcblxuXG4gIHZhciBtZSA9IHRoaXM7XG4gIHRoaXMuZ2V0VXNlclByb2ZpbGUgPSBmdW5jdGlvbihjYWxsYmFjayl7XG4gICAgaWYobWUuY3VycmVudFVzZXIpXG4gICAgICBjYWxsYmFjayhtZS5jdXJyZW50VXNlcik7XG4gICAgcmV0dXJuICRodHRwKHtcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICB1cmw6ICcvc3VzdGVuYW5jZS91c2VyLXByb2ZpbGUvJ1xuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgbWUuY3VycmVudFVzZXIgPSByZXNwb25zZS5kYXRhO1xuICAgICAgY2FsbGJhY2sobWUuY3VycmVudFVzZXIpO1xuICAgIH0pXG4gIH1cblxuXG5cblxuXG5cblxufSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3VzdGVuYW5jZScpLmNvbnRyb2xsZXIoJ2NvbGxlY3Rpb25zQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgbWFpblNydmMsICRzdGF0ZVBhcmFtcyl7XG5cbiRzY29wZS5yZWZyZXNoID0gZnVuY3Rpb24oKXtcblxuXG5cbiAgbWFpblNydmMuZ2V0UHVibGljQ29sbGVjdGlvbnMoKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAkc2NvcGUucHVibGljX2NvbGxlY3Rpb25zID0gcmVzcG9uc2UuZGF0YTtcbiAgICBjb25zb2xlLmxvZygkc2NvcGUucHVibGljX2NvbGxlY3Rpb25zKTtcbiAgfSk7XG5cbiAgJHNjb3BlLmNyZWF0ZUNvbGxlY3Rpb24gPSBmdW5jdGlvbihOYW1lLCBEZXNjcmlwdGlvbiwgSW1hZ2V1cmwpIHtcbiAgICBtYWluU3J2Yy5jcmVhdGVDb2xsZWN0aW9uKE5hbWUsIERlc2NyaXB0aW9uLCBJbWFnZXVybCwgJHJvb3RTY29wZS5jdXJyZW50VXNlci51c2VyaWQpO1xuICAgICRzY29wZS5jb2xsZWN0aW9uX25hbWUgPSAnJztcbiAgICAkc2NvcGUuY29sbGVjdGlvbl9kZXNjcmlwdGlvbiA9ICcnO1xuICAgICRzY29wZS5jb2xsZWN0aW9uX2ltYWdldXJsID0gJyc7XG4gIH1cblxuICAkc2NvcGUuZGVsZXRlQ29sbGVjdGlvbiA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24pe1xuICAgIGNvbnNvbGUubG9nKGNvbGxlY3Rpb24pO1xuICAgIG1haW5TcnZjLmRlbGV0ZUNvbGxlY3Rpb24oY29sbGVjdGlvbikudGhlbihmdW5jdGlvbigpe1xuICAgICAgbWFpblNydmMuZ2V0UHVibGljQ29sbGVjdGlvbnMoKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgJHNjb3BlLnB1YmxpY19jb2xsZWN0aW9ucyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICB9KTtcbiAgICB9KVxuICB9XG5cbm1haW5TcnZjLmdldFVzZXJQcm9maWxlKGZ1bmN0aW9uKGN1cnJlbnRVc2VyKSB7XG4gIGNvbnNvbGUubG9nKCdGSVJFRCcsIGN1cnJlbnRVc2VyKTtcbiAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IGN1cnJlbnRVc2VyO1xuICBtYWluU3J2Yy5nZXRVc2VyQ29sbGVjdGlvbnMoJHJvb3RTY29wZS5jdXJyZW50VXNlci51c2VyaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICRzY29wZS51c2VyX2NvbGxlY3Rpb25zID0gcmVzcG9uc2UuZGF0YTtcbiAgICBjb25zb2xlLmxvZygkc2NvcGUudXNlcl9jb2xsZWN0aW9ucyk7XG4gIH0pO1xufSk7XG5cblxufTtcbiRzY29wZS5yZWZyZXNoKCk7XG5cblxuXG5cblxuXG59KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzdXN0ZW5hbmNlJykuY29udHJvbGxlcignZGV0YWlsc0N0cmwnLCBmdW5jdGlvbigkc2NvcGUsIG1haW5TcnZjLCAkc3RhdGVQYXJhbXMsICRyb290U2NvcGUpe1xuXG4gICRzY29wZS51cGRhdGVDb2xsZWN0aW9uID0gZnVuY3Rpb24oTmFtZSwgRGVzY3JpcHRpb24sIEltYWdldXJsLCB1c2VySWQpIHtcbiAgICBjb25zb2xlLmxvZyh1c2VySWQpO1xuICAgIG1haW5TcnZjLnVwZGF0ZUNvbGxlY3Rpb24oTmFtZSwgRGVzY3JpcHRpb24sIEltYWdldXJsLCB1c2VySWQpO1xuICAgICRzY29wZS5jb2xsZWN0aW9uX25hbWUgPSAnJztcbiAgICAkc2NvcGUuY29sbGVjdGlvbl9kZXNjcmlwdGlvbiA9ICcnO1xuICAgICRzY29wZS5jb2xsZWN0aW9uX2ltYWdldXJsID0gJyc7XG4gICAgJHNjb3BlLmNvbGxlY3Rpb25fdXNlcklkPSAnJztcbiAgfVxuXG4gICRzY29wZS5zZWFyY2hUZXJtID0gZnVuY3Rpb24odGVybSwgbG9jYXRpb24pIHtcbiAgICBjb25zb2xlLmxvZyhsb2NhdGlvbik7XG4gICAgY29uc29sZS5sb2codGVybSk7XG4gICAgbWFpblNydmMuc2VhcmNoVGVybSh0ZXJtLCBsb2NhdGlvbikudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAkc2NvcGUucmVzdGF1cmFudHMgPSBKU09OLnBhcnNlKHJlc3BvbnNlLmJvZHkpO1xuICAgICAgY29uc29sZS5sb2coJHNjb3BlLnJlc3RhdXJhbnRzLmJ1c2luZXNzZXMpO1xuICAgICAgcmV0dXJuICRzY29wZS5yZXN0YXVyYW50cy5idXNpbmVzc2VzO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnNvbGUubG9nKCRyb290U2NvcGUpO1xuXG4gIG1haW5TcnZjLmdldFJlc3RhdXJhbnRDb2xsZWN0aW9uKCRzdGF0ZVBhcmFtcy5jb2xsZWN0aW9uSWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICRzY29wZS5yZXN0YXVyYW50Q29sbGVjdGlvbiA9IHJlc3BvbnNlLmRhdGE7XG4gICAgY29uc29sZS5sb2coJHNjb3BlLnJlc3RhdXJhbnRDb2xsZWN0aW9uKTtcbiAgfSk7XG5cbiAgJHNjb3BlLmFkZFJlc3RhdXJhbnQgPSBmdW5jdGlvbihyZXN0YXVyYW50KXtcbiAgICBtYWluU3J2Yy5hZGRSZXN0YXVyYW50KHJlc3RhdXJhbnQsICRzdGF0ZVBhcmFtcy5jb2xsZWN0aW9uSWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgJHNjb3BlLmFkZCA9IHJlc3BvbnNlLmJvZHk7XG4gICAgfSk7XG4gIH07XG5cbiAgJHNjb3BlLnJlbW92ZVJlc3RhdXJhbnQgPSBmdW5jdGlvbihyZXN0YXVyYW50KXtcbiAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50KTtcbiAgICBtYWluU3J2Yy5yZW1vdmVSZXN0YXVyYW50KHJlc3RhdXJhbnQpLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgIG1haW5TcnZjLmdldFJlc3RhdXJhbnRDb2xsZWN0aW9uKCRzdGF0ZVBhcmFtcy5jb2xsZWN0aW9uSWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAkc2NvcGUucmVzdGF1cmFudENvbGxlY3Rpb24gPSByZXNwb25zZS5kYXRhO1xuICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUucmVzdGF1cmFudENvbGxlY3Rpb24pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG59KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzdXN0ZW5hbmNlJykuY29udHJvbGxlcignaG9tZUN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIG1haW5TcnZjLCAkc3RhdGVQYXJhbXMpe1xuXG4gICRzY29wZS5zZWFyY2hMb2NhdGlvbiA9IGZ1bmN0aW9uKGxvY2F0aW9uKSB7XG4gICAgY29uc29sZS5sb2cobG9jYXRpb24pO1xuICAgIG1haW5TcnZjLnNlYXJjaExvY2F0aW9uKGxvY2F0aW9uKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICRzY29wZS5yZXN0YXVyYW50cyA9IEpTT04ucGFyc2UocmVzcG9uc2UuYm9keSk7XG4gICAgICBjb25zb2xlLmxvZygkc2NvcGUucmVzdGF1cmFudHMuYnVzaW5lc3Nlcyk7XG4gICAgICByZXR1cm4gJHNjb3BlLnJlc3RhdXJhbnRzLmJ1c2luZXNzZXM7XG4gICAgfSk7XG4gIH07XG5cbiAgICBtYWluU3J2Yy5nZXRQdWJsaWNDb2xsZWN0aW9ucygpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgJHNjb3BlLmNvbGxlY3Rpb25zID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5jb2xsZWN0aW9ucyk7XG4gICAgfSk7XG5cbn0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3N1c3RlbmFuY2UnKS5jb250cm9sbGVyKCdsb2dpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIG1haW5TcnZjLCAkc3RhdGVQYXJhbXMpe1xuXG5cblxufSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3VzdGVuYW5jZScpLmNvbnRyb2xsZXIoJ3Byb2ZpbGVDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBtYWluU3J2YywgJHN0YXRlUGFyYW1zKXtcblxuXG59KTtcbiJdfQ==
